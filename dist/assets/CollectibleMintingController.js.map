{"version":3,"file":"CollectibleMintingController.js","sourceRoot":"","sources":["../../src/assets/CollectibleMintingController.ts"],"names":[],"mappings":"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","sourcesContent":["import { EventEmitter } from 'events';\nimport Web3 from 'web3';\nimport { createRaribleSdk } from '@rarible/protocol-ethereum-sdk';\nimport { Web3Ethereum } from '@rarible/web3-ethereum';\nimport { BaseController, BaseConfig, BaseState } from '../BaseController';\nimport type { NetworkState, NetworkType } from '../network/NetworkController';\nimport {\n  MAINNET,\n  RINKEBY,\n  ROPSTEN,\n  IPFS_DEFAULT_GATEWAY_URL,\n  ERC721_RARIBLE_COLLECTIONS,\n} from '../constants';\nimport type { TransactionController } from '../transaction/TransactionController';\nimport type { CollectiblesController } from './CollectiblesController';\n\nexport interface MintingOptions {\n  nftType: 'rarible' | 'custom';\n}\n\nexport interface CollectibleMintingMetaData {\n  name: string;\n  description: string;\n  image: string;\n  attributes: any;\n}\nexport interface CollectibleMintingControllerConfig extends BaseConfig {\n  networkType: NetworkType;\n  selectedAddress: string;\n  chainId: string;\n  ipfsGateway: string;\n  useIPFSSubdomains: boolean;\n  provider: any;\n}\nexport interface CollectibleMintingControllerState extends BaseState {\n  minting: 'awaiting' | 'started' | 'processing' | 'complete';\n}\n\nexport class CollectibleMintingController extends BaseController<\n  CollectibleMintingControllerConfig,\n  CollectibleMintingControllerState\n> {\n  // private async deployNewERC721(\n  //   smartContractBytecode: any,\n  //   name: string,\n  //   symbol: string,\n  // ): Promise<void> {\n  //   const payload = {\n  //     data: smartContractBytecode,\n  //     arguments: [name, symbol],\n  //   };\n  //   const params = {\n  //     from: 'address',\n  //     gas: '0x0',\n  //     gasPrice: '0x3DFB2E',\n  //   };\n\n  //   this.addTransaction({ ...params, ...payload }, 'Contract Deploy');\n  // }\n\n  private async customMint(tokenUri: string) {\n    console.log(tokenUri);\n  }\n\n  async raribleMint(tokenUri: string, royalties: any[]) {\n    const { networkType, selectedAddress } = this.config;\n    if (\n      networkType !== MAINNET &&\n      networkType !== RINKEBY &&\n      networkType !== ROPSTEN\n    ) {\n      throw new Error(\n        `Network ${networkType} not support by Rarible. Use mainnet, rinkeby or ropsten`,\n      );\n    }\n    const creators: any[] = [{ account: selectedAddress, value: 10000 }];\n    const collectionAddress = ERC721_RARIBLE_COLLECTIONS[networkType];\n    const sdk = createRaribleSdk(\n      new Web3Ethereum({ web3: this.web3 }),\n      'rinkeby',\n    );\n    const nftCollection: any = await sdk.apis.nftCollection.getNftCollectionById(\n      {\n        collection: collectionAddress,\n      },\n    );\n\n    console.log(Object.keys(sdk.apis));\n    console.log(Object.keys(sdk.nft));\n\n    const mintingTx = await sdk.nft.mint({\n      collection: nftCollection,\n      uri: tokenUri,\n      creators,\n      royalties,\n      lazy: true,\n    });\n    console.log('mintingTx -> ', mintingTx);\n    return mintingTx;\n  }\n\n  async mint(tokenUri: string, options: MintingOptions) {\n    if (options.nftType === 'rarible') {\n      await this.raribleMint(tokenUri, []);\n    } else {\n      await this.customMint(tokenUri);\n    }\n  }\n\n  /**\n   * EventEmitter instance used to listen to specific transactional events\n   */\n  hub = new EventEmitter();\n\n  /**\n   * Name of this controller used during composition\n   */\n  name = 'CollectibleMintingController';\n\n  private addCollectible: CollectiblesController['addCollectible'];\n\n  private addTransaction: TransactionController['addTransaction'];\n\n  private web3: any;\n\n  /**\n   * Creates the CollectibleMintingController instance.\n   *\n   * @param options - The controller options.\n   * @param options.onNetworkStateChange - Allows subscribing to network controller state changes.\n   * @param options.addCollectible - Allows the controlelr to add a collectible to collectible controller.\n   * @param options.addTransaction - Allows the controler to add a transaction to transaction controller.\n   * @param config - Initial options used to configure this controller.\n   * @param state - Initial state to set on this controller.\n   */\n  constructor(\n    {\n      onNetworkStateChange,\n      addCollectible,\n      addTransaction,\n    }: {\n      onNetworkStateChange: (\n        listener: (networkState: NetworkState) => void,\n      ) => void;\n      addCollectible: CollectiblesController['addCollectible'];\n      addTransaction: TransactionController['addTransaction'];\n    },\n    config?: Partial<BaseConfig>,\n    state?: Partial<CollectibleMintingController>,\n  ) {\n    super(config, state);\n    this.defaultConfig = {\n      networkType: MAINNET,\n      selectedAddress: '',\n      chainId: '',\n      ipfsGateway: IPFS_DEFAULT_GATEWAY_URL,\n      useIPFSSubdomains: true,\n      provider: undefined,\n    };\n\n    this.defaultState = {\n      minting: 'awaiting',\n    };\n    this.initialize();\n    onNetworkStateChange(({ provider }) => {\n      const { chainId } = provider;\n      this.configure({ chainId });\n    });\n    this.addCollectible = addCollectible;\n    this.addTransaction = addTransaction;\n  }\n\n  /**\n   * Sets a new provider.\n   *\n   * @property provider - Provider used to create a new underlying Web3 instance\n   */\n  set provider(provider: any) {\n    this.web3 = new Web3(provider);\n  }\n\n  get provider() {\n    throw new Error('Property only used for setting');\n  }\n}\n\nexport default CollectibleMintingController;\n"]}